---
title: "Homework 8"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r global_options, include=FALSE}
library(knitr)
library(tidyverse)
library(broom)
opts_chunk$set(fig.align="center", fig.height=4, fig.width=5.5)

#data prep:
BA_degrees <- read_csv("https://wilkelab.org/SDS375/datasets/BA_degrees.csv")
BA_degrees
```

*Enter your name and EID here*

Connor Hanna 

cdh3663

**This homework is due on April 11, 2022 at 11:00am. Please submit as a pdf file on Canvas.**

**Problem 1: (6 pts)** Use the dataset `BA_degrees` but focus only on the degree fields "Agriculture and natural resources", "Communication, journalism, and related programs", and "Education". 

Make a single plot that satisfies these three criteria:

(a) Plot a time series of the proportion of degrees (colum `perc`) in each field over time and create a separate panel per degree field. 
(b) Add a straight line fit to each panel.
(c) Order the panels by the difference between the maximum and the minimum proportion (i.e., the range of the data).


```{r}
#filtering to the desired fields
list <- c("Agriculture and natural resources", 
                      "Communication, journalism, and related programs", 
                      "Education")
BA_degrees <- 
  BA_degrees |>
    filter(field %in% list)

#plot generation
BA_degrees |>
  ggplot(
    aes(year, perc)
  ) + 
  geom_col() +
  facet_wrap(vars(field)) +
  geom_smooth(method = "lm")
```

**Problem 2: (4 pts)** 
Create a single pipeline that fits a linear model to each of the three fields from Problem 1 and outputs results in a tidy linear model summary table. The first column of the table should be `field` and the remaining columns should contain the linear model summary statistics such as `r.squared` for each field. Display the resulting table below.

```{r}
BA_degrees |>
  nest(data = -field) |>
  mutate(
    fit = map(data, ~lm(year ~ perc, data = .x)),
    glance_out = map(fit, glance)
  ) |>
  select(field, glance_out) |>
  unnest(cols = glance_out)
```









